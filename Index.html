<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Two Column GitHub Page</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 200px;
      background-color: #2c3e50;
      color: white;
      padding: 20px;
    }
    .sidebar button {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #34495e;
      color: white;
      border: none;
      cursor: pointer;
    }
    .sidebar button:hover {
      background-color: #1abc9c;
    }
    .content {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      width: 400px;
      border-radius: 8px;
    }
    .modal-content input, .modal-content textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      box-sizing: border-box;
    }
    .modal-content button {
      margin-top: 10px;
      padding: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <button id="btn-receipts">Receipts</button>
    <button id="btn-reports">Reports</button>
  </div>
  <div class="content" id="main-content">
    <h1>Welcome</h1>
    <p>Select a page from the sidebar.</p>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2>Add/Edit Transaction</h2>
      <input type="text" id="vendor" placeholder="Vendor Name">
      <input type="text" id="amount" placeholder="Amount">
      <input type="text" id="method" placeholder="Payment Method">
      <input type="date" id="date">
      <input type="text" id="invoice" placeholder="Invoice Number">
      <textarea id="items" placeholder="Items (comma separated)"></textarea>
      <button id="submit-btn">Submit</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7RRmxNUJmwV-zGIWBsjnBoiqSYxklScM",
      authDomain: "receiptapp-14299.firebaseapp.com",
      projectId: "receiptapp-14299",
      storageBucket: "receiptapp-14299.firebasestorage.app",
      messagingSenderId: "132326209159",
      appId: "1:132326209159:web:e002837b0587acee27aa22"
    }; 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    db.settings({ experimentalForceLongPolling: true });

    function openModal() {
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      clearModalFields();
      editingDocId = null;
    }

    function clearModalFields() {
      document.getElementById('vendor').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('method').value = '';
      document.getElementById('date').value = '';
      document.getElementById('invoice').value = '';
      document.getElementById('items').value = '';
    }

    let editingDocId = null;

    function openEditModal(docId) {
      editingDocId = docId;
      db.collection("receipts").doc(docId).get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          document.getElementById('vendor').value = data.vendor || '';
          document.getElementById('amount').value = data.amount || '';
          document.getElementById('method').value = data.method || '';
          document.getElementById('date').value = data.date || '';
          document.getElementById('invoice').value = data.invoice || '';
          document.getElementById('items').value = (data.items || []).join(', ');
          openModal();
        }
      });
    }

    function submitTransaction() {
      const vendor = document.getElementById('vendor').value;
      const amount = document.getElementById('amount').value;
      const method = document.getElementById('method').value;
      const date = document.getElementById('date').value;
      const invoice = document.getElementById('invoice').value;
      const items = document.getElementById('items').value.split(',').map(i => i.trim());

      if (editingDocId) {
        // Update existing receipt
        db.collection("receipts").doc(editingDocId).update({
          vendor, amount, method, date, invoice, items
        }).then(() => {
          closeModal();
          loadPage('receipts');
        }).catch(error => {
          alert("Error updating document: " + error.message);
        });
      } else {
        // Add new receipt
        db.collection("receipts").add({
          vendor, amount, method, date, invoice, items
        }).then(() => {
          closeModal();
          loadPage('receipts');
        }).catch(error => {
          alert("Error adding document: " + error.message);
        });
      }
    }

    const pages = {
      receipts: `
        <h1>Receipts</h1>
        <button id="add-transaction-btn">Add Transaction</button>
        <table>
          <thead>
            <tr>
              <th>Vendor Name</th>
              <th>Amount</th>
              <th>Payment Method</th>
              <th>Date</th>
              <th>Invoice Number</th>
              <th>Edit</th>
            </tr>
          </thead>
          <tbody id="receipt-table-body">
            <!-- Rows will go here -->
          </tbody>
        </table>
      `,
      reports: `<h1>Reports</h1><p>This is the reports page content.</p>`
    };

    function loadPage(page) {
      document.getElementById('main-content').innerHTML = pages[page] || '<p>Page not found.</p>';

      if (page === 'receipts') {
        document.getElementById('add-transaction-btn').addEventListener('click', () => {
          editingDocId = null;
          clearModalFields();
          openModal();
        });

        db.collection("receipts").get().then(snapshot => {
          const tbody = document.getElementById('receipt-table-body');
          tbody.innerHTML = '';
          snapshot.forEach(doc => {
            const r = doc.data();
            const id = doc.id;
            const row = `<tr>
              <td>${r.vendor}</td>
              <td>${r.amount}</td>
              <td>${r.method}</td>
              <td>${r.date}</td>
              <td>${r.invoice}</td>
              <td><button class="edit-btn" data-id="${id}">Edit</button></td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
          });

          // Add listeners for Edit buttons
          document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.getAttribute('data-id');
              openEditModal(id);
            });
          });
        }).catch(error => {
          alert("Error loading receipts: " + error.message);
        });
      }
    }

    document.getElementById('btn-receipts').addEventListener('click', () => loadPage('receipts'));
    document.getElementById('btn-reports').addEventListener('click', () => loadPage('reports'));
    document.getElementById('submit-btn').addEventListener('click', submitTransaction);
  </script>
</body>
</html>
